"use strict";(self.webpackChunksra=self.webpackChunksra||[]).push([[764],{3454:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"usage/Azure/components","title":"SRA Components Breakdown","description":"This section outlines the core components of the Security Reference Architeture (SRA). Several .tf scripts contain direct links to the Databricks Terraform documention.","source":"@site/docs/usage/Azure/components.mdx","sourceDirName":"usage/Azure","slug":"/usage/Azure/components","permalink":"/security-reference-architecture/docs/usage/Azure/components","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Read Before Deploying","permalink":"/security-reference-architecture/docs/usage/Azure/preread"},"next":{"title":"Getting Started","permalink":"/security-reference-architecture/docs/usage/Azure/gettingstarted"}}');var r=s(4848),t=s(8453);s(6025),s(7293);const o={sidebar_position:1},c="SRA Components Breakdown",a={},l=[{value:"Core Azure Components",id:"core-azure-components",level:2},{value:"Core Databricks Components",id:"core-databricks-components",level:2},{value:"Adding Additional Spokes",id:"adding-additional-spokes",level:2},{value:"Security Analysis Tool (SAT)",id:"security-analysis-tool-sat",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"sra-components-breakdown",children:"SRA Components Breakdown"})}),"\n",(0,r.jsxs)(n.p,{children:["This section outlines the core components of the ",(0,r.jsx)(n.strong,{children:"Security Reference Architeture (SRA)"}),". Several ",(0,r.jsx)(n.code,{children:".tf"})," scripts contain direct links to the Databricks Terraform documention.\nThe full Databricks Terraform Provider Documentation can be found ",(0,r.jsx)(n.a,{href:"https://registry.terraform.io/providers/databricks/databricks/latest/docs",children:"here"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"core-azure-components",children:"Core Azure Components"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Vnet Injection"}),": ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/databricks/security/network/classic/vnet-inject",children:"Vnet Injection"})," allows Azure Databricks workspaces to be deployed directly into a customer-managed virtual network (VNet), providing control over network configuration to meet organizational security and governance requirements."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Private Endpoints"}),": Leveraging Azure Private Link, ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/private-link/private-endpoint-overview",children:"private endpoints"})," connect the customer\u2019s VNet to Azure services without using public IP addresses, ensuring secure, private communication."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PrivateLink Connectivity"}),": ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/private-link/private-link-overview",children:"Private Link"})," establishes private network paths between the customer\u2019s data plane and the Databricks control plane, preventing traffic from traversing the public internet. This template configures ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/databricks/security/network/classic/private-link",children:"Back-End Private Link"})," for communication to the Databricks control plane from classic compute clusters."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"core-databricks-components",children:"Core Databricks Components"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Unity Catalog"}),": ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/databricks/data-governance/unity-catalog/",children:"Unity Catalog"})," is a unified governance solution for data and AI assets such as files, tables, and machine learning models. Unity Catalog enforces fine-grained access controls, centralized policy management, auditing, and lineage tracking\u2014all integrated into the Databricks workflow."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Network Connectivity Configuration"}),": Serverless network connectivity is managed with ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/databricks/security/network/serverless-network-security/#ncc",children:"network connectivity configurations (NCC)"}),", which are account-level regional constructs that are used to manage private endpoints creation and firewall enablement at scale. An NCC is created and attached to the workspace, which contains a list of stable Azure service subnets, which will be used by the serverless compute in that workspace to connect the Azure resource using service endpoints."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Restrictive Network Policy"}),": ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/databricks/security/network/serverless-network-security/network-policies",children:"Network Policies"})," implement egress controls for serverless compute by enforcing a restrictive network policy that permits outbound traffic only to required data buckets."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"adding-additional-spokes",children:"Adding Additional Spokes"}),"\n",(0,r.jsx)(n.p,{children:"To add additional spokes to this configuration, follow the steps below."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.strong,{children:["Add a New Key to the ",(0,r.jsx)(n.code,{children:"spoke config"})," Variable"]})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hcl",children:'# Terraform variables (for example, terraform.tfvars)\nspoke_config = {\n  spoke = {\n    resource_suffix = "spoke"\n    cidr            = "10.1.0.0/20"\n    tags = {\n      environment = "dev"\n    },\n  },\n  spoke_b = { # <----- Add a new spoke config\n    resource_suffix = "spoke_b"\n    cidr            = "10.2.0.0/20"\n    tags = {\n      environment = "test"\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.strong,{children:["Add a New Provider in ",(0,r.jsx)(n.code,{children:"providers.tf"})," for the New Spoke"]})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hcl",children:'# providers.tf\n\n# New spoke provider\nprovider "databricks" {\n  alias = "spoke_b"\n  host  = module.spoke_b.workspace_url\n}\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Copy the ",(0,r.jsx)(n.code,{children:"spoke.tf"})," File"]}),": Copy ",(0,r.jsx)(n.code,{children:"spoke.tf"})," to a new file (for example, ",(0,r.jsx)(n.code,{children:"spoke_b.tf"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Modify the Module Names and References"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hcl",children:'# spoke_b.tf\n\nmodule "spoke_b" { # <----- Modify the name of the module to something unique\n  source = "./modules/spoke"\n\n  # Update these per spoke\n  resource_suffix = var.spoke_config["spoke_b"].resource_suffix\n  vnet_cidr       = var.spoke_config["spoke_b"].cidr\n  tags            = var.spoke_config["spoke_b"].tags\n\n  depends_on = [module.hub]\n}\n\nmodule "spoke_b_catalog" {\n  source = "./modules/catalog"\n\n  # Update these per catalog for the catalog\'s spoke\n  catalog_name        = module.spoke_b.resource_suffix\n  dns_zone_ids        = [module.spoke_b.dns_zone_ids["dfs"]]\n  ncc_id              = module.spoke_b.ncc_id\n  resource_group_name = module.spoke_b.resource_group_name\n  resource_suffix     = module.spoke_b.resource_suffix\n  subnet_id           = module.spoke_b.subnet_ids.privatelink\n  tags                = module.spoke_b.tags\n\n  providers = {\n    databricks.workspace = databricks.spoke_b\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Apply the Configuration"}),": ",(0,r.jsx)(n.code,{children:"terraform apply"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"security-analysis-tool-sat",children:"Security Analysis Tool (SAT)"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.a,{href:"https://databricks-industry-solutions.github.io/security-analysis-tool/",children:"Security Analysis Tool (SAT)"})," is enabled by default to continuously monitor the security posture of your Databricks environment. By default, SAT is installed in the ",(0,r.jsx)(n.strong,{children:"hub"})," workspace, also known as the ",(0,r.jsx)(n.code,{children:"WEB_AUTH"})," workspace."]}),"\n",(0,r.jsx)(n.h1,{id:"changing-the-sat-workspace",children:"Changing the SAT Workspace"}),"\n",(0,r.jsxs)(n.p,{children:["To deploy the ",(0,r.jsx)(n.strong,{children:"Security Analysis Tool (SAT)"})," in a different workspace, three modifications are required in ",(0,r.jsx)(n.code,{children:"customizations.tf"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Update the Databricks provider in the SAT module"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hcl",children:"# Default\nproviders = {\n databricks = databricks.hub\n}\n\n# Modified\nproviders = {\n databricks = databricks.spoke\n}\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Update the local sat_workspace reference"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hcl",children:"# Default\nlocals {\n sat_workspace = module.hub\n}\n\n# Modified\nlocals {\n sat_workspace = module.spoke\n}\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.strong,{children:["Update the ",(0,r.jsx)(n.code,{children:"databricks_permission_assignment.sat_workspace_admin"})," resource"]})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hcl",children:'# Default\nresource "databricks_permission_assignment" "sat_workspace_admin" {\n count    = length(module.sat)\n ...\n provider = databricks.hub\n}\n\n# Modified\nresource "databricks_permission_assignment" "sat_workspace_admin" {\n count    = length(module.sat)\n ...\n provider = databricks.spoke\n}\n'})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOTE"}),": The ",(0,r.jsx)(n.strong,{children:"Security Analysis Tool (SAT)"})," is designed to be deployed ",(0,r.jsx)(n.strong,{children:"once per Azure subscription"}),". To deploy SAT in multiple regions, provision SAT in multiple spokes using the same modifications above."]}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"sat-service-principal",children:"SAT Service Principal"}),"\n",(0,r.jsx)(n.p,{children:"Some users may not have permissions to create Entra ID service principals. In this case, a pre-existing service principal can be used:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hcl",children:'# example.tfvars\nsat_service_principal = {\n  client_id     = "00000000-0000-0000-0000-000000000000"\n  client_secret = "some-secret"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"If no service principal is provided, the template creates one named spSAT by default. The name can be customized:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hcl",children:'# example.tfvars\nsat_service_principal = {\n  name = "spSATDev"\n}\n'})}),"\n",(0,r.jsx)(n.h1,{id:"sat-compute",children:"SAT Compute"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"Security Analysis Tool (SAT)"})," is installed using classic compute by default. This is because SAT does not yet support inspecting workspaces outside of the current workspace when running on serverless. If you would like to run on serverless compute instead, you can modify the sat_configuration variable to specify using serverless (see below):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hcl",children:"sat_configuration = {\n  run_on_serverless = true\n}\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOTE"}),": When running the ",(0,r.jsx)(n.strong,{children:"Security Analysis Tool (SAT)"})," on serverless compute, SAT will only inspect the current workspace."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},7293:(e,n,s)=>{s.d(n,{A:()=>M});var i=s(6540),r=s(4848);function t(e){const{mdxAdmonitionTitle:n,rest:s}=function(e){const n=i.Children.toArray(e),s=n.find(e=>i.isValidElement(e)&&"mdxAdmonitionTitle"===e.type),t=n.filter(e=>e!==s),o=s?.props.children;return{mdxAdmonitionTitle:o,rest:t.length>0?(0,r.jsx)(r.Fragment,{children:t}):null}}(e.children),t=e.title??n;return{...e,...t&&{title:t},children:s}}var o=s(4164),c=s(1312),a=s(7559);const l="admonition_xJq3",d="admonitionHeading_Gvgb",u="admonitionIcon_Rf37",h="admonitionContent_BuS1";function p({type:e,className:n,children:s}){return(0,r.jsx)("div",{className:(0,o.A)(a.G.common.admonition,a.G.common.admonitionType(e),l,n),children:s})}function m({icon:e,title:n}){return(0,r.jsxs)("div",{className:d,children:[(0,r.jsx)("span",{className:u,children:e}),n]})}function f({children:e}){return e?(0,r.jsx)("div",{className:h,children:e}):null}function x(e){const{type:n,icon:s,title:i,children:t,className:o}=e;return(0,r.jsxs)(p,{type:n,className:o,children:[i||s?(0,r.jsx)(m,{title:i,icon:s}):null,(0,r.jsx)(f,{children:t})]})}function g(e){return(0,r.jsx)("svg",{viewBox:"0 0 14 16",...e,children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})})}const j={icon:(0,r.jsx)(g,{}),title:(0,r.jsx)(c.A,{id:"theme.admonition.note",description:"The default label used for the Note admonition (:::note)",children:"note"})};function k(e){return(0,r.jsx)(x,{...j,...e,className:(0,o.A)("alert alert--secondary",e.className),children:e.children})}function v(e){return(0,r.jsx)("svg",{viewBox:"0 0 12 16",...e,children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})})}const b={icon:(0,r.jsx)(v,{}),title:(0,r.jsx)(c.A,{id:"theme.admonition.tip",description:"The default label used for the Tip admonition (:::tip)",children:"tip"})};function y(e){return(0,r.jsx)(x,{...b,...e,className:(0,o.A)("alert alert--success",e.className),children:e.children})}function w(e){return(0,r.jsx)("svg",{viewBox:"0 0 14 16",...e,children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})})}const _={icon:(0,r.jsx)(w,{}),title:(0,r.jsx)(c.A,{id:"theme.admonition.info",description:"The default label used for the Info admonition (:::info)",children:"info"})};function A(e){return(0,r.jsx)(x,{..._,...e,className:(0,o.A)("alert alert--info",e.className),children:e.children})}function T(e){return(0,r.jsx)("svg",{viewBox:"0 0 16 16",...e,children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})})}const N={icon:(0,r.jsx)(T,{}),title:(0,r.jsx)(c.A,{id:"theme.admonition.warning",description:"The default label used for the Warning admonition (:::warning)",children:"warning"})};function z(e){return(0,r.jsx)("svg",{viewBox:"0 0 12 16",...e,children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"})})}const S={icon:(0,r.jsx)(z,{}),title:(0,r.jsx)(c.A,{id:"theme.admonition.danger",description:"The default label used for the Danger admonition (:::danger)",children:"danger"})};const C={icon:(0,r.jsx)(T,{}),title:(0,r.jsx)(c.A,{id:"theme.admonition.caution",description:"The default label used for the Caution admonition (:::caution)",children:"caution"})};const D={...{note:k,tip:y,info:A,warning:function(e){return(0,r.jsx)(x,{...N,...e,className:(0,o.A)("alert alert--warning",e.className),children:e.children})},danger:function(e){return(0,r.jsx)(x,{...S,...e,className:(0,o.A)("alert alert--danger",e.className),children:e.children})}},...{secondary:e=>(0,r.jsx)(k,{title:"secondary",...e}),important:e=>(0,r.jsx)(A,{title:"important",...e}),success:e=>(0,r.jsx)(y,{title:"success",...e}),caution:function(e){return(0,r.jsx)(x,{...C,...e,className:(0,o.A)("alert alert--warning",e.className),children:e.children})}}};function M(e){const n=t(e),s=(i=n.type,D[i]||(console.warn(`No admonition component found for admonition type "${i}". Using Info as fallback.`),D.info));var i;return(0,r.jsx)(s,{...n})}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var i=s(6540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);